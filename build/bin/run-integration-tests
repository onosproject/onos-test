#!/bin/bash

# Script to build and run all of the onos integration tests

set -e

if [ -z $1 ]
then
  testSuite="*** Unknown Test Suite ***"
elif [ -n $1 ]
then
# otherwise make first arg as a rental
  testSuite=$1
fi

case "$testSuite" in
"onos-topo")
     # onos-topo
     pushd ..
     GO111MODULE=on go get github.com/onosproject/helmit/cmd/helmit
     git clone https://github.com/onosproject/onos-topo.git
     cd onos-topo
     make kind
     helmit test ./cmd/onos-topo-tests -c ../onos-helm-charts
     popd;;

"onos-config")
    # onos-config
    pushd ..
    GO111MODULE=on go get github.com/onosproject/helmit/cmd/helmit
    git clone https://github.com/onosproject/onos-config.git
    cd onos-config
    make kind
    helmit test ./cmd/onos-config-tests -c ../onos-helm-charts

    helmit benchmark ./cmd/onos-config-benchmarks -c ../onos-helm-charts --requests 5000 --max-latency 5ms --benchmark BenchmarkGet
    helmit benchmark ./cmd/onos-config-benchmarks -c ../onos-helm-charts --requests 5000 --max-latency 20ms --benchmark BenchmarkSet

    popd;;

"onos-ric")
    # onos-ric
    pushd ..
    GO111MODULE=on go get github.com/onosproject/helmit/cmd/helmit
    git clone https://github.com/onosproject/onos-ric.git
    git clone https://github.com/onosproject/onos-helm-charts.git
    GO111MODULE=on go get github.com/onosproject/helmit/cmd/helmit
    cd onos-ric
    make kind
    helmit test ./cmd/onos-ric-tests -c ../onos-helm-charts

    helmit benchmark --benchmark BenchmarkGetStations --requests 10000 --max-latency 2ms ./cmd/onos-ric-benchmarks -c ../onos-helm-charts
    popd;;

"onos-helm-charts")
    # onos-helm-charts
    pushd ..
    GO111MODULE=on go get github.com/onosproject/helmit/cmd/helmit
    git clone https://github.com/onosproject/onos-helm-charts.git
    cd onos-helm-charts
    helmit test ./test -c .
    popd;;

*) echo "You have failed to specify test suite."
    exit 1
    ;;
esac